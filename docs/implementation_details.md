# Документация по реализации калькулятора интегралов

## Общее описание

Калькулятор интегралов реализует адаптивный метод численного интегрирования с использованием производных функции. Основные особенности:

- Адаптивное разбиение интервалов
- Контроль сходимости
- Оценка сложности функции
- Защита от численной нестабильности
- Графический интерфейс
- Типизированный код с использованием dataclasses

## Основные компоненты

### 1. Классы данных

#### IntegrationResult
```python
@dataclass
class IntegrationResult:
    value: Decimal      # Значение интеграла
    points: int        # Количество использованных точек
    is_stable: bool    # Флаг стабильности вычислений
```

#### IntegrationConfig
```python
class IntegrationConfig:
    def __init__(self, 
                 min_interval_size: float = 0.5,
                 max_depth: int = 10,
                 precision: int = 50,
                 max_points: int = 150,
                 min_points: int = 20,
                 stability_threshold: float = 1e10,
                 convergence_threshold: float = 0.01):
```
Класс для централизованного управления параметрами интегрирования:
- `min_interval_size`: Минимальный размер интервала
- `max_depth`: Максимальная глубина рекурсии
- `precision`: Точность вычислений
- `max_points`: Максимальное количество точек на интервале
- `min_points`: Минимальное количество точек на интервале
- `stability_threshold`: Порог стабильности вычислений
- `convergence_threshold`: Порог сходимости

### 2. Класс IntegralCalculator

Основной класс, реализующий графический интерфейс и управление вычислениями.

#### Методы инициализации:
```python
def __init__(self, root):
    self.root = root
    self.root.title("Калькулятор интегралов")
    self.root.geometry("800x600")
    self.config = IntegrationConfig()
    self._setup_ui()
```

#### Ключевые методы:
1. **Настройка интерфейса:**
   ```python
   def _setup_ui(self):
       # Создание и размещение элементов интерфейса
       # Поля ввода функции и пределов
       # Кнопка вычисления
       # Поле вывода результатов
   ```

2. **Валидация входных данных:**
   ```python
   def _validate_input(self) -> Tuple[float, float, float]:
       # Проверка корректности введенных данных
       # Возвращает нижний предел, верхний предел и размер интервала
   ```

3. **Вычисление интеграла:**
   ```python
   def calculate(self):
       # Валидация входных данных
       # Вычисление точного значения
       # Адаптивное интегрирование
       # Отображение результатов
   ```

4. **Отображение результатов:**
   ```python
   def _display_results(self, expression: str, lower_bound: float, 
                       upper_bound: float, exact_value: float, 
                       result: IntegrationResult):
       # Форматирование и вывод результатов
       # Отображение ошибок и предупреждений
   ```

### 3. Функции интегрирования

#### estimate_complexity
```python
def estimate_complexity(expr, x, start: float, end: float, 
                       config: IntegrationConfig) -> int:
```
Оценивает сложность функции на заданном интервале:
1. Вычисляет производные
2. Анализирует значения в ключевых точках
3. Определяет оптимальное количество точек

#### calculate_subinterval
```python
def calculate_subinterval(expr, x, start: float, end: float, 
                         N: int, config: IntegrationConfig) -> IntegrationResult:
```
Вычисляет интеграл на подинтервале:
1. Использует двойное разбиение для оценки сходимости
2. Применяет формулу интегрирования с учетом производных
3. Контролирует стабильность вычислений

#### calculate_adaptive
```python
def calculate_adaptive(expr, x, start: float, end: float, 
                      config: IntegrationConfig, depth: int = 0) -> IntegrationResult:
```
Рекурсивно вычисляет интеграл:
1. Проверяет условия остановки
2. Разбивает интервал на три части
3. Объединяет результаты с контролем стабильности

## Улучшения в новой версии

### 1. Улучшенная структура данных
- Использование dataclass для результатов
- Централизованная конфигурация
- Типизация всех функций и методов

### 2. Улучшенная обработка ошибок
- Отдельный метод для обработки ошибок
- Более информативные сообщения
- Контроль стабильности вычислений

### 3. Улучшенная организация кода
- Разделение GUI на отдельные методы
- Выделение валидации и отображения результатов
- Более чистая структура классов

### 4. Улучшенная конфигурация
- Все параметры в одном месте
- Легко изменяемые значения
- Значения по умолчанию

## Рекомендации по использованию

### 1. Настройка параметров
- `min_interval_size`: 0.5 для простых функций, 0.1-0.25 для сложных
- `max_depth`: 10 по умолчанию, увеличивать для сложных функций
- `precision`: 50 для большинства случаев, можно уменьшить для простых функций

### 2. Работа со сложными функциями
- Использовать меньшие значения `min_interval_size`
- Следить за предупреждениями о нестабильности
- Проверять сходимость на разных интервалах

### 3. Оптимизация производительности
- Для простых функций использовать большие значения `min_interval_size`
- Уменьшать точность вычислений при необходимости
- Следить за количеством точек на интервалах

## Заключение

Калькулятор интегралов реализует сложный адаптивный алгоритм с улучшенной структурой кода и расширенными возможностями:
- Типизированный код с использованием современных возможностей Python
- Улучшенная обработка ошибок и контроль стабильности
- Централизованное управление параметрами
- Модульная структура с четким разделением ответственности

Для эффективного использования важно понимать влияние параметров и правильно их настраивать под конкретные задачи. 